```bash
ansible-playbook playbooks/playbook_psql.yml

PLAY [Install python and pip] *************************************************************************************************************************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
ok: [88.198.111.144]

TASK [Install Python] *********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
ok: [88.198.111.144]

TASK [Download get-pip.py script] *********************************************************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [88.198.111.144]

TASK [Install pip using get-pip.py] *******************************************************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [88.198.111.144]

TASK [Install psycopg2-binary] ************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [88.198.111.144]

PLAY [db] *********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
ok: [88.198.111.144]

TASK [common : Update package lists] ******************************************************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [88.198.111.144]

TASK [common : Upgrade all packages] ******************************************************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [88.198.111.144]

TASK [common : Install public AuthorizedKeysFile] *****************************************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [88.198.111.144]

TASK [common : Install required packages] *************************************************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [88.198.111.144]

TASK [common : Allow everything and enable UFW] *******************************************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [88.198.111.144]

TASK [common : Allow incoming traffic on specified ports] *********************************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [88.198.111.144] => (item=22)

TASK [common : Configure Fail2Ban] ********************************************************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [88.198.111.144]

TASK [common : Restart fail2ban] **********************************************************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [88.198.111.144]

TASK [common : SSH Hardening for root user] ***********************************************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [88.198.111.144]

TASK [common : Restart sshd] **************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [88.198.111.144]

TASK [postgresql : include_vars] **********************************************************************************************************************************************************************************************************************************************************************************************************************************************************
ok: [88.198.111.144] => (item=/home/ujstor/code/ujstor/deployment-cluster-s3-psqldb/ansible/playbooks/roles/postgresql/vars/../vars/Debian_22.yml)

TASK [postgresql : include_vars] **********************************************************************************************************************************************************************************************************************************************************************************************************************************************************
ok: [88.198.111.144] => (item=/home/ujstor/code/ujstor/deployment-cluster-s3-psqldb/ansible/playbooks/roles/postgresql/vars/../vars/postgresql_16.yml)

TASK [postgresql : PostgreSQL | Make sure the CA certificates are available | apt] ********************************************************************************************************************************************************************************************************************************************************************************************************
ok: [88.198.111.144]

TASK [postgresql : PostgreSQL | Add PostgreSQL repository apt-key | apt] ******************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [88.198.111.144]

TASK [postgresql : PostgreSQL | Add PostgreSQL repository | apt] **************************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [88.198.111.144]

TASK [postgresql : PostgreSQL | Add PostgreSQL repository preferences | apt] **************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [88.198.111.144]

TASK [postgresql : PostgreSQL | Install PostgreSQL | apt] *********************************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [88.198.111.144]

TASK [postgresql : PostgreSQL | PGTune | apt] *********************************************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Install all the required dependencies (yum) | RHEL] *******************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Add PostgreSQL repository | RHEL] *************************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Disable postgresql module (necessary for RHEL8+)] *********************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Install PostgreSQL | RHEL] ********************************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Setup service users profile | RHEL] ***********************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Create ~/pgtab.example | RHEL] ****************************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Create ~/pgtab header | RHEL] *****************************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Create ~/pgtab Ansible warning | RHEL] ********************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Add database to ~/pgtab | RHEL] ***************************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | PGTune | RHEL] ********************************************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgrSQL | Install all the required dependencies | dnf] ***************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PIP install psycopg2-binary on Fedora 33 only if postgresql version < 10] **********************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Add yum Repository | dnf] *********************************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Install PostgreSQL | dnf] *********************************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | PGTune | dnf] *********************************************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Extensions | Make sure the postgres contrib extensions are installed | Debian] ****************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Extensions | Make sure the postgres contrib extensions are installed | RedHat] ****************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Extensions | Make sure the postgres contrib extensions are installed | Fedora] ****************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Extensions | Make sure the development headers are installed | Debian] ************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Extensions | Make sure the development headers are installed | RedHat] ************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Extensions | Make sure the development headers are installed | Fedora] ************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : include_vars] **********************************************************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144] => (item=/home/ujstor/code/ujstor/deployment-cluster-s3-psqldb/ansible/playbooks/roles/postgresql/vars/../vars/jammy.yml)
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Extensions | Make sure the postgis extensions are installed | Debian] *************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Extensions | Make sure the postgis extensions are installed | RedHat] *************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Extensions | Make sure the postgis extensions are installed | Fedora] *************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : include_vars] **********************************************************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Extensions | Add repo keys | apt] *************************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Extensions | Add repos | apt] *****************************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Extensions | Add repos | RHEL] ****************************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Extensions | Add packages | apt] **************************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Extensions | Add packages | RHEL] *************************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | FDW | Load OS specific variables] *************************************************************************************************************************************************************************************************************************************************************************************************************************
ok: [88.198.111.144]

TASK [postgresql : PostgreSQL | FDW | MySQL] **********************************************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | FDW | OGR] ************************************************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Drop the data directory | RedHat] *************************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Make sure the postgres data directory exists] *************************************************************************************************************************************************************************************************************************************************************************************************************
ok: [88.198.111.144]

TASK [postgresql : PostgreSQL | Make sure postgres tablespaces directories exist] *********************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Make sure the postgres WAL directory exists] **************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Make sure the postgres log directory exists] **************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [88.198.111.144]

TASK [postgresql : PostgreSQL | Ensure the locale for lc_collate and lc_ctype is generated | Debian] **************************************************************************************************************************************************************************************************************************************************************************************
ok: [88.198.111.144] => (item=en_US.UTF-8)
ok: [88.198.111.144] => (item=en_US.UTF-8)

TASK [postgresql : PostgreSQL | Ensure the locale is generated | RedHat] ******************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144] => (item={'parts': ['en_US', 'UTF-8'], 'locale_name': 'en_US.UTF-8'})
skipping: [88.198.111.144] => (item={'parts': ['en_US', 'UTF-8'], 'locale_name': 'en_US.UTF-8'})
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Stop PostgreSQL | Debian] *********************************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Reset the cluster - drop the existing one | Debian] *******************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Reset the cluster - create a new one (with specified encoding and locale) | Debian] ***********************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Update systemd | Debian] **********************************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Start PostgreSQL | Debian] ********************************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Check whether the postgres data directory is initialized | RedHat] ****************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Initialize the database | RedHat] *************************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Verify postgresql cluster version] ************************************************************************************************************************************************************************************************************************************************************************************************************************
ok: [88.198.111.144]

TASK [postgresql : PostgreSQL | Ensure configuration directory exists] ********************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [88.198.111.144]

TASK [postgresql : PostgreSQL | Update configuration - pt. 1 (pg_hba.conf)] ***************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [88.198.111.144]

TASK [postgresql : PostgreSQL | Update configuration - pt. 2 (postgresql.conf)] ***********************************************************************************************************************************************************************************************************************************************************************************************************
changed: [88.198.111.144]

TASK [postgresql : PostgreSQL | Update configuration - pt. 3 (pgtune)] ********************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Update configuration - pt. 4 (pg_ident.conf)] *************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [88.198.111.144]

TASK [postgresql : PostgreSQL | Create folder for additional configuration files] *********************************************************************************************************************************************************************************************************************************************************************************************************
ok: [88.198.111.144]

TASK [postgresql : PostgreSQL | Ensure the systemd directory for PostgreSQL exists | RedHat] **********************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Use the conf directory when starting the Postgres service | RedHat] ***************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Ensure the pid directory for PostgreSQL exists] ***********************************************************************************************************************************************************************************************************************************************************************************************************
ok: [88.198.111.144]

TASK [postgresql : PostgreSQL | Ensure PostgreSQL is running] *****************************************************************************************************************************************************************************************************************************************************************************************************************************
ok: [88.198.111.144]

TASK [postgresql : PostgreSQL | Reload PostgreSQL configuration] **************************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [88.198.111.144]

TASK [postgresql : PostgreSQL | Ensure PostgreSQL is running] *****************************************************************************************************************************************************************************************************************************************************************************************************************************
ok: [88.198.111.144]

TASK [postgresql : PostgreSQL | Make sure the PostgreSQL users are present] ***************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [88.198.111.144] => (item={'name': 'ujstor', 'pass': 'password1234', 'encrypted': True, 'state': 'present'})
[WARNING]: Module remote_tmp /var/lib/postgresql/.ansible/tmp did not exist and was created with a mode of 0700, this may cause issues when running as another user. To avoid this, create the remote_tmp dir with the correct permissions manually

TASK [postgresql : PostgreSQL | Ensure PostgreSQL is running] *****************************************************************************************************************************************************************************************************************************************************************************************************************************
ok: [88.198.111.144]

TASK [postgresql : PostgreSQL | Make sure the PostgreSQL databases are present] ***********************************************************************************************************************************************************************************************************************************************************************************************************
changed: [88.198.111.144] => (item={'name': 'blueprint', 'owner': 'ujstor', 'state': 'present'})

TASK [postgresql : PostgreSQL | Add extensions to the databases] **************************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Add hstore to the databases with the requirement] *********************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144] => (item={'name': 'blueprint', 'owner': 'ujstor', 'state': 'present'})
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Add uuid-ossp to the database with the requirement] *******************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144] => (item={'name': 'blueprint', 'owner': 'ujstor', 'state': 'present'})
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Add postgis to the databases with the requirement] ********************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144] => (item={'name': 'blueprint', 'owner': 'ujstor', 'state': 'present'})
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | add cube to the database with the requirement] ************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144] => (item={'name': 'blueprint', 'owner': 'ujstor', 'state': 'present'})
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Add plpgsql to the database with the requirement] *********************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144] => (item={'name': 'blueprint', 'owner': 'ujstor', 'state': 'present'})
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | add earthdistance to the database with the requirement] ***************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144] => (item={'name': 'blueprint', 'owner': 'ujstor', 'state': 'present'})
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Add citext to the database with the requirement] **********************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144] => (item={'name': 'blueprint', 'owner': 'ujstor', 'state': 'present'})
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Add Schema to databases] **********************************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [88.198.111.144] => (item={'database': 'blueprint', 'schema': 'ujstor-test', 'state': 'present'})

TASK [postgresql : PostgreSQL | Update the user privileges] *******************************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [88.198.111.144] => (item={'name': 'ujstor', 'db': 'blueprint', 'role_attr_flags': 'SUPERUSER'})

TASK [postgresql : PostgreSQL | (Monit) Copy the postgresql monit service file] ***********************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [postgresql : PostgreSQL | Check binary version] *************************************************************************************************************************************************************************************************************************************************************************************************************************************
ok: [88.198.111.144]

TASK [postgresql : PostgreSQL | Check database version] ***********************************************************************************************************************************************************************************************************************************************************************************************************************************
ok: [88.198.111.144]

TASK [postgresql : PostgreSQL | Verify binary and database versions match] ****************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [88.198.111.144]

TASK [Allow DB Port] **********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [88.198.111.144]

RUNNING HANDLER [postgresql : restart postgresql] *****************************************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [88.198.111.144]

PLAY RECAP ********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
88.198.111.144             : ok=46   changed=29   unreachable=0    failed=0    skipped=58   rescued=0    ignored=0


```
